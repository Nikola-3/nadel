name: expecting one child error on extensive field argument passed to synthetic hydration
enabled:
  current: true
  nextgen: true
overallSchema:
  TestBoard: |
    service TestBoard {
      type Query {
        board(id: ID): SoftwareBoard
      }
      type SoftwareBoard @renamed(from: "Board") {
        id: ID
        cardChildren: [SoftwareCard] @renamed(from: "issueChildren")
      }
      type SoftwareCard @renamed(from: "Card") {
        id: ID
        assignee: User => hydrated from Users.usersQuery.users(accountIds: $source.issue.assignee.accountId) object identified by accountId, batch size 3
      }
    }
  Users: |
    service Users {
      type Query {
        usersQuery: UserQuery
      }
      type UserQuery {
        users(accountIds: [ID]): [User]
      }
      type User {
        accountId: ID
      }
    }
underlyingSchema:
  TestBoard: |
    type Board {
      id: ID
      issueChildren: [Card]
    }

    type Card {
      id: ID
      issue: Issue
    }

    type Issue {
      assignee: TestUser
      id: ID
    }

    type Query {
      board(id: ID): Board
    }

    type TestUser {
      accountId: String
    }
  Users: |
    type Query {
      usersQuery: UserQuery
    }

    type User {
      accountId: ID
    }

    type UserQuery {
      users(accountIds: [ID]): [User]
    }
query: |
  query {
    board(id: 1) {
      id
      cardChildren {
        assignee {
          accountId
        }
      }
    }
  }
variables: {}
serviceCalls:
  current:
    - serviceName: TestBoard
      request:
        query: |
          query nadel_2_TestBoard {
            board(id: 1) {
              id
              issueChildren {
                issue {
                  assignee {
                    accountId
                  }
                }
              }
            }
          }
        variables: {}
        operationName: nadel_2_TestBoard
      # language=JSON
      response: |-
        {
          "data": {
            "board": {
              "id": "1",
              "issueChildren": [
                {
                  "issue": {
                    "assignee": {
                      "accountId": "1"
                    }
                  }
                },
                {
                  "issue": {
                    "assignee": {
                      "accountId": "2"
                    }
                  }
                },
                {
                  "issue": {
                    "assignee": {
                      "accountId": "3"
                    }
                  }
                }
              ]
            }
          },
          "extensions": {}
        }
    - serviceName: Users
      request:
        query: |
          query nadel_2_Users {
            usersQuery {
              users(accountIds: ["1", "2", "3"]) {
                accountId
                object_identifier__UUID: accountId
              }
            }
          }
        variables: {}
        operationName: nadel_2_Users
      # language=JSON
      response: |-
        {
          "data": {
            "usersQuery": {
              "users": [
                {
                  "accountId": "1",
                  "object_identifier__UUID": "1"
                },
                {
                  "accountId": "2",
                  "object_identifier__UUID": "2"
                },
                {
                  "accountId": "3",
                  "object_identifier__UUID": "3"
                }
              ]
            }
          },
          "extensions": {}
        }
  nextgen:
    - serviceName: TestBoard
      request:
        query: |
          query {
            ... on Query {
              board(id: 1) {
                ... on Board {
                  __typename__rename__cardChildren: __typename
                  id
                  rename__cardChildren__issueChildren: issueChildren {
                    ... on Card {
                      __typename__batch_hydration__assignee: __typename
                      batch_hydration__assignee__issue: issue {
                        ... on Issue {
                          assignee {
                            ... on TestUser {
                              accountId
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        variables: {}
        operationName: null
      # language=JSON
      response: |-
        {
          "data": {
            "board": {
              "__typename__rename__cardChildren": "Board",
              "id": "1",
              "rename__cardChildren__issueChildren": [
                {
                  "__typename__batch_hydration__assignee": "Card",
                  "batch_hydration__assignee__issue": {
                    "assignee": {
                      "accountId": "1"
                    }
                  }
                },
                {
                  "__typename__batch_hydration__assignee": "Card",
                  "batch_hydration__assignee__issue": {
                    "assignee": {
                      "accountId": "2"
                    }
                  }
                },
                {
                  "__typename__batch_hydration__assignee": "Card",
                  "batch_hydration__assignee__issue": {
                    "assignee": {
                      "accountId": "3"
                    }
                  }
                }
              ]
            }
          },
          "extensions": {}
        }
    - serviceName: Users
      request:
        query: |
          query {
            ... on Query {
              usersQuery {
                ... on UserQuery {
                  users(accountIds: ["1", "2", "3"]) {
                    ... on User {
                      accountId
                      batch_hydration__assignee__accountId: accountId
                    }
                  }
                }
              }
            }
          }
        variables: {}
        operationName: null
      # language=JSON
      response: |-
        {
          "data": {
            "usersQuery": {
              "users": [
                {
                  "batch_hydration__assignee__accountId": "1",
                  "accountId": "1"
                },
                {
                  "batch_hydration__assignee__accountId": "2",
                  "accountId": "2"
                },
                {
                  "batch_hydration__assignee__accountId": "3",
                  "accountId": "3"
                }
              ]
            }
          },
          "extensions": {}
        }
# language=JSON
response: |-
  {
    "data": {
      "board": {
        "id": "1",
        "cardChildren": [
          {
            "assignee": {
              "accountId": "1"
            }
          },
          {
            "assignee": {
              "accountId": "2"
            }
          },
          {
            "assignee": {
              "accountId": "3"
            }
          }
        ]
      }
    },
    "extensions": {}
  }
